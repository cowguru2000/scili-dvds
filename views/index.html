<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>SciLi Entertainment DVD</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.min.js"></script>
  </head>
  <body>
    <img class="bg" src="http://library.brown.edu/about/scili/SciLi-768px.jpg" />
    <div id="content">
      <input autofill="off" autocomplete="off" id="search" type="text" placeholder="Search for a title or genre..."/>
    </div>
    <div id="results"></div>
<script type="text/javascript">
$(document).ready(function() {
  var searchTimer;
  var config = {
    searchDelay: 300,
    minChars: 2
  };
  var resultDiv = $('#results');
  var tmpl = $('#result-tmpl').html();
  Mustache.parse(tmpl);
  $('#search').on('keyup', function(ev) {
    resultDiv.empty();
    if (searchTimer) {
      clearTimeout(searchTimer);
    }
    var searchVal = $('#search').val();
    if (searchVal.length >= config.minChars) {
      searchTimer = setTimeout(function() {
        resultDiv.empty();
        $.get('/search', {
          'q': $('#search').val()
        }, function(resp) {
          resp['results'].forEach(function(elt) {
            resultDiv.append(Mustache.render(tmpl, elt));
          });
        });
      }, config.searchDelay);
    }
  });
});
</script>
<script id="result-tmpl" type="x-tmpl-mustache">
<div class="result{{^available}} unavailable{{/available}}">
  {{#plot_short}}<img src="/posters/{{josiah_callno}}.jpg" class="poster" />{{/plot_short}}
  {{^plot_short}}<div class="poster"></div>{{/plot_short}}
  <h3>{{title}}</h3>
  <p class="plot">{{plot_short}}</p>
  <ul class="genres">
  {{#genres}}
    <li>{{.}}</li>
  {{/genres}}
  </ul>
  <div class="available {{#available}}yes{{/available}}{{^available}}no{{/available}}"></div>
</div>
</script>
<div id="credits">Poster images courtesy of <a href="http://www.imdb.com">IMDB</a>. Background photo via <a href="http://library.brown.edu/about/scili/">Brown University Library</a>.</div>
  </body>
</html>
